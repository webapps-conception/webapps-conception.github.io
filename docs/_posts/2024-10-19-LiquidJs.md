layout: post
title: "D√©velopper en LiquidJs"
date: 2024-10-19 23:00:00 +0002
tags: node

# D√©velopper en Liquid Js

[LiquidJS](https://liquidjs.com/){:target="_blank"} est un moteur de template initialement d√©velopp√© par le directeur g√©n√©ral de Shopify, Tobias L√ºtke et √©crit en Ruby. C'est un projet open-source disponible sur Github. La premi√®re version remonte √† 2008. Le balisage Liquid est tr√®s similaire au HTML avec quelques ajouts.

üìù Quelques exemples d'utilisation : [webapps-conception/liquidjs-example](https://github.com/webapps-conception/liquidjs-example){:target="_blank"}.

## Le langage du template Liquid

LiquidJS est un moteur de mod√®les compatible [Shopify](https://github.com/Shopify/liquid){:target="_blank"} / GitHub Pages simple, expressif et s√ªr en JavaScript pur. Le but de ce r√©f√©rentiel est de fournir une impl√©mentation Liquid standard pour la communaut√© JavaScript. Liquid est √† l'origine impl√©ment√© dans Ruby et utilis√© par GitHub Pages, Jekyll et Shopify, voir [Diff√©rences avec Shopify/liquid](https://liquidjs.com/tutorials/differences.html){:target="_blank"}.

La syntaxe LiquidJS est relativement simple. Il existe 2 types de balises dans LiquidJS¬†:

- **Tags** : Une balise se compose d'un nom de balise et d'arguments facultatifs entour√©s entre `{<!---->%` et ` % }`.
- **Outputs** : Une sortie consiste en une valeur et une liste de filtres, facultative, entour√©e entre `{{` et `}}`.

> **Live Demo** : Before going into the details, here‚Äôs a live demo to play around: https://liquidjs.com/playground.html.

### Outputs

Les ¬´¬†Outputs¬†¬ª sont utilis√©es pour g√©n√©rer des variables, qui peuvent √™tre transform√©es par des filtres, en HTML. Le mod√®le suivant ins√©rera la valeur de `username` dans la valeur de l'entr√©e¬†:

``` html
<input type="text" name="user" value="{{username}}">
```

Les valeurs en sortie peuvent √™tre transform√©es par des filtres avant la sortie. Pour ajouter une cha√Æne apr√®s la variable¬†:
``` js
{{ username | append: ", welcome to LiquidJS!" }}
```

Les filtres peuvent √™tre cha√Æn√©s¬†:
``` js
{{ username | append: ", welcome to LiquidJS!" | capitalize }}
```

Une liste compl√®te des filtres pris en charge par LiquidJS peut √™tre trouv√©e [ici](https://liquidjs.com/filters/overview.html){:target="_blank"}.

### Tags

Les `Tags` sont utilis√©es pour contr√¥ler le processus de rendu du mod√®le, la manipulation des variables du mod√®le, l'interop√©rabilit√© avec d'autres mod√®les, etc. Par exemple, `assign` peut √™tre utilis√© pour d√©finir une variable qui peut √™tre utilis√©e ult√©rieurement dans le mod√®le¬†:


``` js
{ % assign foo = "FOO" % }
```

G√©n√©ralement, les balises apparaissent par paires avec une balise de d√©but et une balise de fin correspondante. Par exemple:

``` js
{ % if foo == "FOO" % }
    Variable `foo` equals "FOO"
{ % else % }
    Variable `foo` not equals "FOO"
{ % endif % }
```

Une liste compl√®te des balises prises en charge par LiquidJS peut √™tre trouv√©e [ici](https://liquidjs.com/tags/overview.html){:target="_blank"}.

## Setup
### LiquidJS in Node.js

Installer via npm¬†:
``` bash
npm install --save liquidjs
var { Liquid } = require('liquidjs');
var engine = new Liquid();

engine
    .parseAndRender('{{name | capitalize}}', {name: 'alice'})
    .then(console.log);     // outputs 'Alice'
```

> **D√©mo de travail** : Voici une d√©mo fonctionnelle pour l'utilisation de LiquidJS dans Node.js : [liquidjs/demo/nodejs/](https://github.com/harttle/liquidjs/blob/master/demo/nodejs/){:target="_blank"}.

Les d√©finitions de types pour LiquidJS sont √©galement export√©es et publi√©es, ce qui le rend plus agr√©able pour les projets TypeScript¬†:

``` js
import { Liquid } from 'liquidjs';
const engine = new Liquid();

engine
    .parseAndRender('{{name | capitalize}}', {name: 'alice'})
    .then(console.log);     // outputs 'Alice'
```

> **D√©mo de travail** : Voici une d√©mo fonctionnelle pour l'utilisation de LiquidJS dans TypeScript : [liquidjs/demo/typescript/}(https://github.com/harttle/liquidjs/blob/master/demo/typescript/){:target="_blank"}

### LiquidJS in Browsers

Des bundles UMD pr√©d√©finis sont √©galement disponibles¬†:

``` js
<!--for production-->
<script src="https://cdn.jsdelivr.net/npm/liquidjs/dist/liquid.browser.min.js"></script>
<!--for development-->
<script src="https://cdn.jsdelivr.net/npm/liquidjs/dist/liquid.browser.umd.js"></script>
```

> **D√©mo de travail** : Voici une d√©mo vivante sur jsFiddle: [jsfiddle.net/pd4jhzLs/1/](https://jsfiddle.net/pd4jhzLs/1/){:target="_blank"}, et le code source est √©galement disponible en [liquidjs/demo/browser/](https://github.com/harttle/liquidjs/blob/master/demo/browser/){:target="_blank"}.

### LiquidJS in CLI

LiquidJS peut √©galement √™tre utilis√© pour restituer un mod√®le directement depuis la CLI en utilisant `npx`¬†:

``` bash
npx liquidjs --template '{{"hello" | capitalize}}'
```

Vous pouvez soit transmettre le mod√®le en ligne (comme indiqu√© ci-dessus), soit le lire √† partir d'un fichier en utilisant le caract√®re `@` suivi d'un chemin, comme ceci¬†:

``` bash
npx liquidjs --template @./some-template.liquid
```

Vous pouvez √©galement utiliser la syntaxe `@-` pour lire le mod√®le depuis `stdin`¬†:

``` bash
echo '{{"hello" | capitalize}}' | npx liquidjs --template @-
```

Un contexte peut √™tre transmis de la m√™me mani√®re (c'est-√†-dire en ligne, √† partir d'un chemin ou via `stdin`). Les trois suivants sont √©quivalents¬†:

``` bash
npx liquidjs --template 'Hello, {{ name }}!' --context '{"name": "Snake"}'
npx liquidjs --template 'Hello, {{ name }}!' --context @./some-context.json
echo '{"name": "Snake"}' | npx liquidjs --template 'Hello, {{ name }}!' --context @-
```

Notez que vous ne pouvez utiliser `stdin` avec le sp√©cificateur  `@-` que pour un seul argument. Si vous essayez de l'utiliser √† la fois pour `--template` et `--context`, vous obtiendrez une erreur.

La sortie rendue est √©crite sur `stdout` par d√©faut, mais vous pouvez √©galement sp√©cifier un fichier de sortie (si le fichier existe, il sera √©cras√©)¬†:

``` bash
npx liquidjs --template '{{"hello" | capitalize}}' --output ./hello.txt
```

Vous pouvez √©galement transmettre un certain nombre d'options pour personnaliser le comportement de rendu du mod√®le. Par exemple, l'option --js-truthy peut √™tre utilis√©e pour activer la v√©racit√© de JavaScript¬†:

``` bash
npx liquidjs --template @./some-template.liquid --js-truthy
```

La plupart des [options disponibles via l'API JavaScript](https://liquidjs.com/tutorials/options.html){:target="_blank"} sont √©galement disponibles √† partir de la CLI. Pour obtenir de l'aide sur les options disponibles, utilisez `npx liquidjs --help`.

Une d√©mo ReactJS est √©galement disponible sous [liquidjs/demo/reactjs/](https://github.com/harttle/liquidjs/blob/master/demo/reactjs/){:target="_blank"}.

## Options

Le constructeur [Liquid](https://liquidjs.com/api/classes/Liquid.html){:target="_blank"} accepte un objet simple comme option pour d√©finir le comportement de LiquidJS. Toutes ces options sont facultatives, nous pouvons donc en sp√©cifier n'importe laquelle, par exemple l'option `cache`¬†:

``` js
const { Liquid } = require('liquidjs')
const engine = new Liquid({
    cache: true
})
```

> **API Document** : Voici un aper√ßu de toutes les options. Pour les types et signatures exacts, veuillez vous r√©f√©rer √† [LiquidOptions API](https://liquidjs.com/api/interfaces/LiquidOptions.html){:target="_blank"}.

### Cache

Le `cache` est utilis√© pour am√©liorer les performances en mettant en cache les structures de mod√®les pr√©c√©demment analys√©es, en particulier dans les cas o√π nous analysons ou restituons des fichiers √† plusieurs reprises.

La valeur par d√©faut est `false`. Lorsque la valeur est `true`, un cache LRU par d√©faut de taille 1024 sera activ√©. Et bien s√ªr, il peut s'agir d'un nombre qui indique la taille du cache souhait√©e.

De plus, il peut √©galement s'agir d'une impl√©mentation de cache personnalis√©e. Voir [Mise en cache](https://liquidjs.com/tutorials/caching.html){:target="_blank"} pour plus de d√©tails.

### Partials/Layouts

**root** est utilis√© pour sp√©cifier les r√©pertoires de mod√®les permettant √† LiquidJS de rechercher et de lire les fichiers de mod√®les. Peut √™tre une cha√Æne unique ou un tableau de cha√Ænes. Voir [Render Files](https://liquidjs.com/tutorials/render-file.html){:target="_blank"} pour plus de d√©tails.

**layouts** est utilis√© pour sp√©cifier des r√©pertoires de mod√®les pour que LiquidJS recherche des fichiers pour `{ % layout % }`. M√™me format que `root` et sera par d√©faut `root` s'il n'est pas sp√©cifi√©.

**partials** est utilis√© pour sp√©cifier des r√©pertoires de mod√®les pour que LiquidJS recherche des fichiers pour `{ % render % }` et `{ % include % }`. M√™me format que `root` et sera par d√©faut `root` s'il n'est pas sp√©cifi√©.

**relativeReference** est d√©fini sur `true` par d√©faut pour autoriser les noms de fichiers relatifs. Notez que les fichiers relativement r√©f√©renc√©s doivent √©galement se trouver dans la racine correspondante. Par exemple, vous pouvez r√©f√©rencer un autre fichier comme `{ % render ../foo/bar % }` tant que `../foo/bar` se trouve √©galement dans le r√©pertoire `partials`.

### dynamicPartials

> **Note** : pour des raisons historiques, il s'appelle DynamicPartials mais il fonctionne √©galement pour les mises en page.

**dynamicPartials** indique s'il faut ou non traiter les arguments de nom de fichier dans les balises include, render et layout comme une variable. La valeur par d√©faut est `true`. Par exemple, le rendu de l'extrait suivant avec scope `{ file: 'foo.html' }` inclura le `foo.html`¬†:

``` js
{ % include file % }
```

En d√©finissant `dynamicPartials: false`, LiquidJS essaiera d'inclure le fichier nomm√© `file`, ce qui est √©trange mais permet une syntaxe plus simple si vos relations de mod√®le sont statiques¬†:

``` js
{ % liquid foo.html % }
```
> **Pi√®ge courant** : LiquidJS d√©finit par d√©faut cette option sur `true` pour √™tre compatible avec shopify/liquid, mais si vous venez de [eleventy](https://github.com/11ty/eleventy){:target="_blank"}, elle est d√©finie sur `false` par d√©faut (voir [Quoted Include Paths](https://www.11ty.dev/docs/languages/liquid/#quoted-include-paths){:target="_blank"}) qui, je crois, essaie d'√™tre compatible avec Jekyll.

### Jekyll include

[jekyllInclude](https://liquidjs.com/api/interfaces/LiquidOptions.html#jekyllInclude){:target="_blank"} est utilis√© pour activer la syntaxe d'inclusion de type Jekyll-like. La valeur par d√©faut est `false`, lorsqu'elle est d√©finie sur `true`¬†:

- Le nom de fichier sera statique¬†: `dynamicPartials` est d√©sormais d√©fini par d√©faut sur `false` (au lieu de `true`). Et vous pouvez red√©finir `dynamicPartials` sur `true`.
- Utilisez `=` au lieu de `:` pour s√©parer les valeurs-cl√©s des param√®tres.
- Les param√®tres sont sous la variable `include` au lieu de la port√©e actuelle.

Par exemple, dans le mod√®le suivant, `name.html` n'est pas cit√©, `header` et `"HEADER"` sont s√©par√©s par `=` et le param√®tre `header` est r√©f√©renc√© par `include.header`. Pour plus de d√©tails, veuillez consulter [include](https://liquidjs.com/tags/include.html){:target="_blank"}.

``` html
// entry template
{ % include article.html header="HEADER" content="CONTENT" % }

// article.html
<article>
  <header>{{include.header}}</header>
  {{include.content}}
</article>
```

### extname

`extname` d√©finit le nom d'extension par d√©faut √† ajouter aux noms de fichiers si le nom de fichier n'a pas de nom d'extension. La valeur par d√©faut est `''`, ce qui signifie qu'il est d√©sactiv√© par d√©faut. En le r√©glant sur `.liquid`¬†:

``` html
{ % render "foo" % }  there's no extname, adds `.liquid` and loads foo.liquid
{ % render "foo.html" % }  there is an extname already, loads foo.html directly
```

> **Legacy Versions** : Avant la version 2.0.1, `extname est d√©fini par d√©faut sur `.liquid`. Pour changer cela, vous devez d√©finir explicitement `extname: ''`. Voir [#41](https://github.com/harttle/liquidjs/issues/41){:target="_blank"} pour plus de d√©tails.

### fs

**fs** est utilis√© pour d√©finir une impl√©mentation de syst√®me de fichiers personnalis√©e qui sera utilis√©e par LiquidJS pour rechercher et lire les fichiers mod√®les. Voir [Abstract File System](https://liquidjs.com/tutorials/render-file.html#Abstract-File-System){:target="_blank"} pour plus de d√©tails.

### globals

**globals** est utilis√© pour d√©finir des variables globales disponibles pour tous les mod√®les, m√™me en cas de [render tag](https://liquidjs.com/tags/render.html){:target="_blank"}. Voir [3185](https://github.com/harttle/liquidjs/issues/185){:target="_blank"} pour plus de d√©tails.

### jsTruthy

**jsTruthy** est utilis√© pour utiliser la v√©racit√© JavaScript standard plut√¥t que Shopify.

la valeur par d√©faut est `false`. Par exemple, lorsqu'elle est d√©finie sur `true`, une cha√Æne vide sera √©valu√©e comme `false` avec `jsTruthy`. Avec la v√©racit√© de Shopify, une cha√Æne vide est `true`.

### outputEscape

[outputEscape](https://liquidjs.com/api/interfaces/LiquidOptions.html#outputEscape){:target="_blank"} peut √™tre utilis√© pour √©chapper automatiquement les cha√Ænes de sortie. Il peut s'agir de `"escape"`, `"json"` ou `(val: inconnu) => string`, la valeur par d√©faut est `undefined`.

- Pour les variables de sortie non fiables, d√©finissez `outputEscape¬†: "escape"` les fait √™tre √©chapp√©es en HTML par d√©faut. Vous aurez besoin d‚Äôun filtre brut pour une sortie directe.
- `"json"` est utile lorsque vous utilisez LiquidJS pour cr√©er des fichiers JSON valides.
- Il peut m√™me s'agir d'une fonction qui vous permet de contr√¥ler quelles variables sont sorties dans LiquidJS. Veuillez noter que l'entr√©e peut √™tre de n'importe quel type autre qu'une cha√Æne, par ex. un filtre a renvoy√© une valeur non-cha√Æne.

### Date

**timezoneOffset** est utilis√© pour sp√©cifier un fuseau horaire diff√©rent pour afficher les dates, votre fuseau horaire local sera utilis√© s'il n'est pas sp√©cifi√©. Par exemple, d√©finir `timezoneOffset: 0` pour afficher toutes les dates en UTC/GMT 00:00.

**preserveTimezones** est un bool√©en qui n'effectue que des horodatages litt√©raux. Lorsqu'ils sont d√©finis sur `true`, tous les horodatages litt√©raux resteront les m√™mes lors de la sortie. Il s'agit d'une option d'analyseur, donc les objets Date transmis √† LiquidJS en tant que donn√©es ne seront pas affect√©s. Notez que `preserveTimezones` a une priorit√© plus √©lev√©e que `timezoneOffset`.

**dateFormat** est utilis√© pour sp√©cifier un format par d√©faut pour les dates de sortie. `%A, %B %-e, %Y at %-l:%M %P %z` sera utilis√© s‚Äôil n‚Äôest pas sp√©cifi√©. Par exemple, d√©finissez `dateFormat: %Y-%m-%dT%H:%M:%S:%LZ` pour afficher toutes les dates dans le format [JavaScript Date.toJson()](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/toJSON){:target="_blank"}.

### Trimming

Les options **greedy**, **trimOutputLeft**, **trimOutputRight**, **trimTagLeft**, **trimTagRight** sont utilis√©es pour √©liminer les nouvelles lignes et les retraits suppl√©mentaires dans les mod√®les autour des constructions liquides. Voir [Whitespace Control](https://liquidjs.com/tutorials/whitespace-control.html){:target="_blank"} pour plus de d√©tails.

### Delimiter

**outputDelimiterLeft**, **outputDelimiterRight**, **tagDelimiterLeft**, **tagDelimiterRight** sont utilis√©s pour personnaliser les d√©limiteurs pour LiquidJS [Tags and Filters](https://liquidjs.com/tutorials/intro-to-liquid.html){:target="_blank"}. Par exemple avec `outputDelimiterLeft : <%=, outputDelimiterRight : %>` nous pouvons √©viter les conflits avec d'autres langages :

``` js
<%= username | append: ", welcome to LiquidJS!" %>
```

### Strict

**strictFilters** est utilis√© pour affirmer l'existence du filtre. S'il est d√©fini sur `false`, les filtres non d√©finis seront ignor√©s. Sinon, les filtres non d√©finis provoqueront une exception d'analyse. La valeur par d√©faut est `false`.

**strictVariables** est utilis√© pour affirmer l'existence d'une variable. Si la valeur est `false`, les variables non d√©finies seront rendues sous forme de cha√Æne vide. Sinon, les variables non d√©finies provoqueront une exception de rendu. La valeur par d√©faut est `false`.

**lenientIf** modifie le comportement de `strictVariables` pour permettre la gestion des variables facultatives. Si elle est d√©finie sur `true`, une variable non d√©finie ne provoquera pas d'exception dans les deux situations suivantes : a) c'est la condition d'une balise `if`, `elsif` ou `unless` ; b) cela se produit juste avant un filtre par `default`. Sans importance si `strictVariables` n'est pas d√©fini. La valeur par d√©faut est `false`.

**ownPropertyOnly** masque les variables de port√©e des prototypes, ce qui est utile lorsque vous transmettez un objet non nettoy√© dans LiquidJS ou que vous devez masquer les prototypes des mod√®les. La valeur par d√©faut est `true`.

> **Nonexistent Tags** : Les balises inexistantes g√©n√®rent toujours des erreurs lors de l'analyse et ce comportement ne peut pas √™tre personnalis√©.

### Parameter Order

Les ordres de param√®tres sont ignor√©s par d√©faut, car ea `{ % for i in (1..8) reversed limit:3 % }` ex√©cutera toujours la `limit` avant `reversed`, m√™me si `reversed` se produit avant la `limit`. Pour que l'ordre des param√®tres soit respect√©, d√©finissez **orderedFilterParameters** sur `true`. Sa valeur par d√©faut est `false`.

## Render Files

Pour un projet typique, il peut y avoir un r√©pertoire de fichiers mod√®les, vous devrez d√©finir le [template root](https://liquidjs.com/api/interfaces/LiquidOptions.html#root){:target="_blank"} et appeler [renderFile](https://liquidjs.com/api/classes/Liquid.html#renderFile){:target="_blank"} ou [renderFileSync](https://liquidjs.com/api/classes/Liquid.html#renderFileSync){:target="_blank"} pour restituer un fichier sp√©cifique.

### Render a File

Par exemple, vous disposez d'un r√©pertoire de mod√®les comme celui-ci¬†:

```
.
‚îú‚îÄ‚îÄ index.js
‚îî‚îÄ‚îÄ views/
  ‚îú‚îÄ‚îÄ hello.liquid
  ‚îî‚îÄ‚îÄ world.liquid
```

`hello.liquid` contient une seule ligne `name¬†: {{name}}`.

Enregistrez maintenant le contenu suivant dans `index.js`¬†:

``` js
var engine = new Liquid({
    root: path.resolve(__dirname, 'views/'),  // root for layouts/includes lookup
    extname: '.liquid'          // used for layouts/includes, defaults ""
});
engine
    .renderFile("hello", {name: 'alice'})   // will read and render `views/hello.liquid`
    .then(console.log)  // outputs "Alice"
```

Ex√©cutez `node index.js` et vous obtiendrez un r√©sultat comme ceci¬†:

``` bash
> node index.js
name: alice
```

### Template Lookup

Noms des fichiers mod√®les transmis aux balises API [renderFile](https://liquidjs.com/api/classes/Liquid.html#renderFile){:target="_blank"}, [parseFile](https://liquidjs.com/api/classes/Liquid.html#parseFile){:target="_blank"}, [renderFileSync](https://liquidjs.com/api/classes/Liquid.html#renderFileSync){:target="_blank"}, [parseFileSync](https://liquidjs.com/api/classes/Liquid.html#parseFileSync){:target="_blank"}, et [include](https://help.shopify.com/themes/liquid/tags/theme-tags#include){:target="_blank"}, [layout](https://help.shopify.com/en/themes/liquid/tags/theme-tags#layout){:target="_blank"} sont r√©solues par rapport √† [the root option](https://liquidjs.com/api/interfaces/LiquidOptions.html#root){:target="_blank"}.

Il peut s'agir d'un chemin de type cha√Æne (voir l'exemple ci-dessus) ou d'une liste de r√©pertoires racine, auquel cas les mod√®les seront recherch√©s dans cet ordre. par ex.

``` js
var engine = new Liquid({
    root: ['views/', 'views/partials/'],
    extname: '.liquid'
});
```

> **Chemins relatifs** : Les chemins relatifs dans `root` seront r√©solus par rapport √† `cwd()`.

Lorsque `{ % render "foo" % }` est rendu ou que `liquid.renderFile('foo')` est appel√©, les fichiers suivants seront recherch√©s et le premier fichier existant sera utilis√©¬†:

- `cwd()`/views/foo.liquid
- `cwd()`/views/partials/foo.liquid

Si aucun des fichiers ci-dessus n'existe, une erreur `ENOENT` sera g√©n√©r√©e. Voici une d√©mo pour Node.js¬†: [demo/nodejs](https://github.com/harttle/liquidjs/tree/master/demo/nodejs){:target="_blank"}.

Lorsque LiquidJS est utilis√© dans le navigateur, disons que l'emplacement actuel est <https://example.com/bar/index.html>{:target="_blank"}, seule la premi√®re racine sera utilis√©e et le fichier √† r√©cup√©rer est¬†:

- <https://example.com/bar/foo.liquid>{:target="_blank"}

Si la r√©cup√©ration √©choue, une erreur 404/500 ou des pannes de r√©seau par exemple, une erreur `ENOENT` sera g√©n√©r√©e.
Voici une d√©mo pour les navigateurs¬†: [demo/browser](https://github.com/harttle/liquidjs/tree/master/demo/browser){:target="_blank"}.

### Abstract File System

LiquidJS d√©finit une [interface de syst√®me de fichiers abstraite](https://liquidjs.com/api/interfaces/FS.html){:target="_blank"} et l'impl√©mentation par d√©faut est [src/fs/fs-impl.ts](https://github.com/harttle/liquidjs/blob/master/src/fs/fs-impl.ts){:target="_blank"} pour Node.js et [src/build/fs-impl-browser.ts](https://github.com/harttle/liquidjs/blob/master/src/fs/fs-impl-browser.ts){:target="_blank"} pour le bundle de navigateur.

Le constructeur Liquid fournit une option fs pour sp√©cifier l'impl√©mentation du syst√®me de fichiers. Il est cens√© √™tre utilis√© pour d√©finir une logique de r√©cup√©ration de mod√®le personnalis√©e, c'est-√†-dire r√©cup√©rer un mod√®le √† partir d'une table de base de donn√©es, comme¬†:

``` js
var engine = new Liquid({
    fs: {
        readFileSync (file) {
            return db.model('Template').findByIdSync(file).text
        },
        async readFile (file) {
            const template = await db.model('Template').findById(file)
            return template.text
        },
        existsSync () {
            return true
        },
        async exists () {
            return true
        },
        contains () {
            return true
        },
        resolve(root, file, ext) {
            return file
        }
    }
});
```

> **Vuln√©rabilit√© de travers√©e de chemin** : La valeur par d√©faut de `contain()` renvoie toujours true. Cela signifie que lorsque vous sp√©cifiez un syst√®me de fichiers abstrait, vous devrez fournir un `contain()` appropri√© pour √©viter d'exposer de telles vuln√©rabilit√©s.

### In-memory Template

Pour faciliter le rendu sans fichiers, il existe une option de `templates` permettant de sp√©cifier un mappage des noms de fichiers et de leur contenu. LiquidJS lira les mod√®les du mappage.

``` js
const engine = new Liquid({
  templates: {
    'views/entry': 'header { % include "../partials/footer" % }',
    'partials/footer': 'footer'
  }
})
engine.renderFileSync('views/entry'))
// Result: 'header footer'
```

Notez que les options du syst√®me de fichiers telles que `root`, `layouts`, `partials`, `relativeReference` seront ignor√©es lorsque les `templates` sont sp√©cifi√©s.

## Partials and Layouts
### Render Partials

Pour les fichiers mod√®les suivants¬†:

``` js
// file: color.liquid
color: '{{ color }}' shape: '{{ shape }}'

// file: theme.liquid
{ % assign shape = 'circle' % }
{ % render 'color.liquid' % }
{ % render 'color.liquid' with 'red' % }
{ % render 'color.liquid', color: 'yellow', shape: 'square' % }
```

Le r√©sultat sera¬†:
```
color: '' shape: 'circle'
color: 'red' shape: 'circle'
color: 'yellow' shape: 'square'
```

Pour plus de d√©tails, veuillez vous r√©f√©rer √† la balise [render](https://liquidjs.com/tags/render.html){:target="_blank"}.

> **L'extension ".liquid"** : L'extension ¬´ .liquid ¬ª dans le `layout`, `render` et`include` peut √™tre omise si l'instance Liquid est cr√©√©e √† l'aide de l'option extname : ¬´ .liquid ¬ª. Voir [ the extname option ](https://liquidjs.com/tutorials/options.html#extname){:target="_blank"} pour plus de d√©tails.

### Layout Templates (Extends)

Pour les fichiers mod√®les suivants¬†:

``` js
// file: default-layout.liquid
Header
{ % block content % }My default content{ % endblock % }
Footer

// file: page.liquid
{ % layout "default-layout.liquid" % }
{ % block content % }My page content{ % endblock % }
```

La sortie de `page.liquid`¬†:

```
Header
My page content
Footer
```

Pour plus de d√©tails, veuillez vous r√©f√©rer √† la balise [layout](https://liquidjs.com/tags/layout.html){:target="_blank"}.

## Use in Express.js

LiquidJS est compatible avec les [express template engines](https://expressjs.com/en/resources/template-engines.html){:target="_blank"}. Vous pouvez d√©finir l'instance liquidjs sur l'option du [view engine](https://expressjs.com/en/guide/using-template-engines.html){:target="_blank"}¬†:

``` js
var { Liquid } = require('liquidjs');
var engine = new Liquid();

// register liquid engine
app.engine('liquid', engine.express()); 
app.set('views', './views');            // specify the views directory
app.set('view engine', 'liquid');       // set liquid to default
```

> **D√©mo de travail** : Voici une d√©mo fonctionnelle pour l'utilisation de LiquidJS dans Express.js¬†: [liquidjs/demo/express/](https://github.com/harttle/liquidjs/blob/master/demo/express/){:target="_blank"}.

### Template Lookup

L'option [root](https://liquidjs.com/api/interfaces/LiquidOptions.html#root) continuera √† fonctionner en tant que racine des mod√®les, comme vous pouvez le voir dans [Render A Template File](https://liquidjs.com/tutorials/render-a-file.html){:target="_blank"}. De plus, l'option [`views`](https://expressjs.com/en/guide/using-template-engines.html){:target="_blank"} dans express.js (comme indiqu√© ci-dessus) sera √©galement respect√©e. Supposons que vous ayez un r√©pertoire de mod√®les tel que¬†:

```
.
‚îú‚îÄ‚îÄ views1/
‚îÇ ‚îî‚îÄ‚îÄ hello.liquid
‚îî‚îÄ‚îÄ views2/
  ‚îî‚îÄ‚îÄ world.liquid
```

Et vous d√©finissez la racine du mod√®le pour liquidjs sur `views1` et expressjs sur `views2`¬†:

``` js
var { Liquid } = require('liquidjs');
var engine = new Liquid({
    root: './views1/'
});

app.engine('liquid', engine.express()); 
app.set('views', './views2');            // specify the views directory
app.set('view engine', 'liquid');       // set liquid to default
```

`hello.liquid` et `world.liquid` peuvent √™tre r√©solus et rendus¬†:

``` js
res.render('hello')
res.render('world')
```

### Caching

D√©finir simplement l'[cache option](https://liquidjs.com/api/interfaces/LiquidOptions.html#cache){:target="_blank"} sur true activera la mise en cache des mod√®les, comme expliqu√© dans [Caching](https://liquidjs.com/tutorials/caching.html){:target="_blank"}. Il est recommand√© d'activer le cache dans l'environnement de production, ce qui peut √™tre fait en¬†:

``` js
var { Liquid } = require('liquidjs');
var engine = new Liquid({
    cache: process.env.NODE_ENV === 'production'
});
```

## Caching

Dans un projet de site Web typique, nous aurons un r√©pertoire de mod√®les de vues et ils seront rendus plusieurs fois. Dans un environnement de production, les fichiers mod√®les ne sont pas susceptibles d'√™tre modifi√©s au fil du temps (en dehors des red√©ploiements). Il est donc logique de mettre en cache le contenu des fichiers et les mod√®les analys√©s (dans une sorte d'AST) pour am√©liorer les performances.

LiquidJS propose plusieurs fa√ßons de mettre en cache les mod√®les analys√©s pour am√©liorer les performances.

### Programmatically

Les API [.parse()](https://liquidjs.com/api/classes/Liquid.html#parse){:target="_blank"}, [.parseFile()](https://liquidjs.com/api/classes/Liquid.html#parseFile){:target="_blank"}, [.parseFileSync()](https://liquidjs.com/api/classes/Liquid.html#parseFileSync){:target="_blank"} sont utilis√©es pour analyser des mod√®les √† partir d'une cha√Æne ou de fichiers. Le mod√®le de r√©sultat peut ensuite √™tre rendu plusieurs fois avec un contexte diff√©rent.

Analyser √† partir de la cha√Æne¬†:

``` js
var tpl = engine.parse('{{name | capitalize}}');

engine.renderSync(tpl, {name: 'alice'}) // 'Alice'
engine.renderSync(tpl, {name: 'bob'}) // 'Bob'
```

Analyser √† partir du fichier¬†:

``` js
var tpl = engine.parseFileSync('hello');    // contents of `hello.liquid`: {{name}}

engine.renderSync(tpl, {name: 'alice'}) // 'Alice'
engine.renderSync(tpl, {name: 'bob'}) // 'Bob'
```

La cha√Æne/le fichier du mod√®le n'est analys√© qu'une seule fois et restitu√© plusieurs fois en utilisant un contexte diff√©rent. Les mod√®les de diff√©rents fichiers peuvent √™tre stock√©s dans une `Map` et peuvent √™tre r√©cup√©r√©s directement pour les rendus ult√©rieurs.

### The cache Option

Le [cache option](https://liquidjs.com/api/interfaces/LiquidOptions.html#cache){:target="_blank"} peut √™tre d√©finie pour demander √† liquidjs d'utiliser des mod√®les analys√©s en cache chaque fois que vous appelez [renderFile](https://liquidjs.com/api/classes/Liquid.html#renderFile){:target="_blank"} ou [renderFileSync](https://liquidjs.com/api/classes/Liquid.html#renderFileSync){:target="_blank"}.

``` js
var { Liquid } = require('liquidjs');
var engine = new Liquid({
    cache: true
});

// liquidjs parses the hello.liquid, then renders it with {name: 'alice'}
engine.renderFileSync('hello', {name: 'alice'})

// liquidjs finds the cached template, then renders it with {name: 'bob'}
engine.renderFileSync('hello', {name: 'bob'})
```

## Escaping

L'√©vasion est importante dans tous les langages, y compris LiquidJS. Alors que l'√©chappement a 2 significations diff√©rentes pour un moteur de mod√®le¬†:

- √âchappement pour la sortie, c'est-√†-dire √©chappement HTML. Utilis√© pour √©chapper aux caract√®res sp√©ciaux HTML afin que la sortie ne casse pas les structures HTML, c'est-√†-dire HTML s√©curis√©.
- S'√©vader pour la langue elle-m√™me, c'est-√†-dire l'√©vasion liquide. Utilis√© pour g√©n√©rer des cha√Ænes consid√©r√©es comme sp√©ciales en langage Liquid. Cela sera utile lorsque vous r√©digerez un article dans le mod√®le Liquid pour pr√©senter le langage Liquid.

### HTML Escape

Par d√©faut, la sortie n'est pas √©chapp√©e. Bien que vous puissiez utiliser le filtre [escape](https://liquidjs.com/filters/escape.html){:target="_blank"} pour cela¬†:

Saisir :

``` js
{{ "1 < 2" | escape }}
```

Sortie :

``` js
1 &lt; 2
```

Il existe √©galement des filtres [escape_once](https://liquidjs.com/filters/escape.html){:target="_blank"}, [newline_to_br](https://liquidjs.com/filters/newline_to_br.html){:target="_blank"}, [strip_html](https://liquidjs.com/filters/strip_html.html){:target="_blank"} pour vous permettre d'affiner votre sortie.

Dans les cas o√π les variables ne sont g√©n√©ralement pas fiables, [outputEscape](https://liquidjs.com/tutorials/options.html#outputEscape){:target="_blank"} peut √™tre d√©fini sur `"escape"` pour appliquer l'√©chappement par d√©faut. Dans ce cas, lorsque vous avez besoin de ne pas √©chapper une sortie, un filtre [raw](https://liquidjs.com/filters/raw.html){:target="_blank"} peut √™tre utilis√©¬†:

Saisir :

``` js
{{ "1 < 2" }}
{{ "<button>OK</button>" | raw }}
```

Sortie :

``` js
1 &lt; 2
<button>OK</button>
```

### Liquid Escape

Pour d√©sactiver le langage Liquid et les cha√Ænes de sortie telles que `{ {` et `{ %`, la balise [raw](https://liquidjs.com/filters/raw.html){:target="_blank"} peut √™tre utilis√©e.

Saisir :

``` js
{ % raw % }
  In LiquidJS, {{ this | escape }} will be HTML-escaped, but
  {{{ that }}} will not.
{ % endraw % }
```

Sortie :

``` js
In LiquidJS, {{ this | escape }} will be HTML-escaped, but
{{{ that }}} will not.
```

Dans les cha√Ænes litt√©rales du mod√®le LiquidJS, `\` peut √™tre utilis√© pour √©chapper aux caract√®res sp√©ciaux dans la syntaxe des cha√Ænes. Par exemple:

Saisir :

``` js
{{ "\"" }}
```

Sortie :
``` js
"
```

## Register Filters/Tags
### Register Tags

``` js
// Usage: { % upper name % }
import { Value, TagToken, Context, Emitter, TopLevelToken } from 'liquidjs'

engine.registerTag('upper', {
    parse: function(tagToken: TagToken, remainTokens: TopLevelToken[]) {
        this.value = new Value(token.args, liquid)
    },
    render: function*(ctx: Context) {
        const str = yield this.value.value(ctx); // 'alice'
        return str.toUpperCase() // 'ALICE'
    }
});
```

`parse`¬†: lit les jetons de `remainTokens` jusqu'√† votre jeton de fin.
`render`¬†: combinez les donn√©es de port√©e avec vos jetons analys√©s dans une cha√Æne HTML.

Pour une impl√©mentation de balises complexe, vous pouvez √©galement fournir une classe de balises¬†:

``` js
// Usage: { % upper name:"alice" % }
import { Hash, Tag, TagToken, Context, Emitter, TopLevelToken, Liquid } from 'liquidjs'

engine.registerTag('upper', class UpperTag extends Tag {
    private hash: Hash
    constructor(tagToken: TagToken, remainTokens: TopLevelToken[], liquid: Liquid) {
        super(tagToken, remainTokens, liquid)
        this.hash = new Hash(tagToken.args)
    }
    * render(ctx: Context) {
        const hash = yield this.hash.render();
        return hash.name.toUpperCase() // 'ALICE'
    }
});
```

- Voir les impl√©mentations de balises existantes ici¬†: <https://github.com/harttle/liquidjs/tree/master/src/tags>{:target="_blank"}
- Voir l'exemple de d√©monstration ici¬†: <https://github.com/harttle/liquidjs/blob/master/demo/typescript/index.ts>{:target="_blank"}

### Register Filters

``` js
// Usage: {{ name | upper }}
engine.registerFilter('upper', v => v.toUpperCase())
```

Les arguments de filtre seront transmis √† la fonction de filtre enregistr√©e, par exemple¬†:

``` js
// Usage: {{ 1 | add: 2, 3 }}
engine.registerFilter('add', (initial, arg1, arg2) => initial + arg1 + arg2)
```

Voir les impl√©mentations de filtres existantes ici¬†: <https://github.com/harttle/liquidjs/tree/master/src/filters>{:target="_blank"}

### Unregister Tags/Filters

Dans certains cas, il est souhaitable de d√©sactiver certaines balises/filtres (voir [#324](https://github.com/harttle/liquidjs/issues/324){:target="_blank"}), vous devrez enregistrer une balise/filtre factice dans lequel une erreur correspondante est g√©n√©r√©e.

``` js
// disable a tag
const disabledTag = {
    parse: function(token) {
        throw new Error(`tag "${token.name}" disabled`);
    }
}
engine.registerTag('include', disabledTag);

// disable a filter
function disabledFilter(name) {
    return function () {
        throw new Error(`filter "${name}" disabled`);
    }
}
engine.registerFilter('plus', disabledFilter('plus'));
```

## Access Scope in Filters

Comme indiqu√© dans [Register Filters/Tags](https://liquidjs.com/tutorials/register-filters-tags.html){:target="_blank"}, nous pouvons acc√©der aux arguments de filtre directement dans la fonction de filtre comme¬†:

``` js
// Usage: {{ 1 | add: 2, 3 }}
// Output: 6
engine.registerFilter('add', (initial, arg1, arg2) => initial + arg1 + arg2)
```

Lorsqu'il s'agit de filtres avec √©tat, par exemple pour transformer un chemin d'URL en URL compl√®te, nous devrons acc√©der √† une `origin` dans la port√©e actuelle¬†:

``` js
// Usage: {{ '/index.html' | fullURL }}
// Scope: { origin: "https://liquidjs.com" }
// Output: https://liquidjs.com/index.html

engine.registerFilter('fullURL', function (path) {
    const origin = this.context.get(['origin'])
    return new URL(path, origin).toString() 
})
```

Voir ce JSFiddle¬†: <https://jsfiddle.net/ctj364up/1/>{:target="_blank"}

> **Arrow Functions** : ceci dans les fonctions fl√©ch√©es est li√© au contexte JavaScript actuel, vous devrez utiliser la syntaxe `function(){}` au lieu de la syntaxe `()=>{}` pour acc√©der correctement √† `this.context`.

## Parse Parameters
### Access Raw Parameters

Comme indiqu√© dans [Register Filters/Tags](https://liquidjs.com/tutorials/register-filters-tags.html){:target="_blank"}, les param√®tres de balise sont disponibles sur `tagToken.args` sous forme de cha√Æne raw. Par exemple:

``` js
// Usage: { % random foo bar coo % }
// Output: "foo", "bar" or "coo"
engine.registerTag('random', {
  parse(tagToken) {
    // tagToken.args === "foo bar coo"
    this.items = tagToken.args.split(' ')
  },
  render(context, emitter) {
    // get a random index
    const index = Math.floor(this.items.length * Math.random())
    // output that item
    emitter.write(this.items[index])
  }
})
```

Voici une version JSFiddle¬†: <https://jsfiddle.net/ctj364up/2/>{:target="_blank"}

### Parse Parameters as Values

Parfois, nous avons besoin de balises plus dynamiques et souhaitons transmettre des valeurs √† la balise personnalis√©e au lieu de cha√Ænes statiques. Les variables dans LiquidJS peuvent √™tre litt√©rales (cha√Æne, nombre, etc.) ou une variable de la port√©e du contexte actuel.

Le mod√®le modifi√© suivant contient √©galement 3 valeurs al√©atoires, mais ce sont des valeurs au lieu de cha√Ænes statiques. Le premier est une cha√Æne litt√©rale, le deuxi√®me est un identifiant, le troisi√®me est une s√©quence d'acc√®s √† la propri√©t√© contenant deux identifiants.

``` js
{ % random "foo" bar obj.coo % }
```

Il peut √™tre difficile d'analyser tous ces cas manuellement, mais il existe une classe [Tokenizer](https://liquidjs.com/api/classes/Tokenizer.html){:target="_blank"} dans LiquidJS que vous pouvez utiliser.

``` js
const { Liquid, Tokenizer, evalToken } = require('liquidjs')
engine.registerTag('random', {
  parse(tagToken) {
    const tokenizer = new Tokenizer(tagToken.args)
    this.items = []
    while (!tokenizer.end()) {
      // here readValue() returns a LiteralToken or PropertyAccessToken
      this.items.push(tokenizer.readValue())
    }
  },
  * render(context, emitter) {
    const index = Math.floor(this.items.length * Math.random())
    const token = this.items[index]
    // in LiquidJS, we use yield to wait for async call
    const value = yield evalToken(token, context)
    emitter.write(value)
  }
})
```

L'appel de cette balise dans scope `{ bar: "bar", obj: { coo: "coo" } }` donne exactement le m√™me r√©sultat que le premier exemple. Voir ce JSFiddle¬†: <https://jsfiddle.net/ctj364up/3/>{:target="_blank"}

> **Async and Promises** : Les appels asynchrones dans LiquidJS sont impl√©ment√©s directement par les g√©n√©rateurs, car nous pouvons appeler les g√©n√©rateurs de mani√®re synchrone, donc cette impl√©mentation de balise est √©galement valable pour `renderSync()`, `parseAndRenderSync()`, `renderFileSync()`. Si vous devez attendre une promesse dans l'impl√©mentation de la balise, remplacez simplement `wait somePromise` par `yield somePromise` et gardez `* render()` au lieu de `async render()` fera l'affaire. Voir [Sync et Async](https://liquidjs.com/tutorials/sync-and-async.html){:target="_blank"} pour plus de d√©tails.

### Parse Key-Value Pairs as Named Parameters

Les param√®tres nomm√©s deviennent tr√®s pratiques lorsqu‚Äôil y a des param√®tres facultatifs ou de nombreux param√®tres, auquel cas l‚Äôordre des param√®tres n‚Äôa pas d‚Äôimportance. C‚Äôest exactement pour cela que la classe Hash a √©t√© invent√©e.

``` js
{ % random from:2, to:max % }
```

Dans l'exemple ci-dessus, nous essayons de g√©n√©rer un nombre al√©atoire dans la plage [2, max]. Nous utiliserons `Hash` pour analyser les param√®tres `from` et `to`.

``` js
const { Liquid, Hash } = require('liquidjs')

engine.registerTag('random', {
  parse(tagToken) {
    // parse the parameters structure into `this.args`
    this.args = new Hash(tagToken.args)
  },
  * render(context, emitter) {
    // evaluate the parameters in `context`
    const {from, to} = yield this.args.render(context)
    const length = to - from + 1
    const value = from + Math.floor(length * Math.random())
    emitter.write(value)
  }
})
```

Le rendu de `{ % random from:2, to:max % }` dans la port√©e `{ max: 10 }` g√©n√©rera un nombre al√©atoire dans la plage [2, 10]. Voir ce JSFiddle¬†: <https://jsfiddle.net/ctj364up/4/>{:target="_blank"}

## Render Tag Content

Les balises personnalis√©es peuvent avoir un mod√®le de contenu et peuvent √™tre imbriqu√©es. Cet article d√©crit comment impl√©menter des balises personnalis√©es compos√©es d'une balise de d√©but , d'une balise de fin et d'un contenu de mod√®le entre elles.

### Render Tag Content

Nous commencerons avec une balise simple `wrap` qui enveloppe son contenu dans un √©l√©ment `<div class="wrapper"></div>` :

``` js
{ % wrap % }
  {{ "hello world!" | capitalize }}
{ % endwrap % }
```

R√©sultat attendu :

``` html
<div class='wrapper'>
  Hello world!
</div>
```

Tout d'abord, [register](https://liquidjs.com/tutorials/register-filters-tags.html){:target="_blank"} une balise avec le nom `wrap` et analysez le contenu dans `this.tpls`. Ici dans `parse(tagToken, remainTokens)`,

- `tagToken` est le jeton actuel `{ % wrap % }`, et
- `remainTokens` est un tableau de tous les jetons suivant `{ % wrap % }` jusqu'√† la fin de ce fichier mod√®le.

En gros, ce que nous devons faire est de prendre `.shift()` suffisamment de balises jusqu'√† `remainTokens` ce que nous obtenions un jeton `endwrap` (le nom peut √™tre arbitraire, mais par convention, nous avons besoin qu'il soit `endwrap`). Et s'il n'y a pas de `endwrap` jusqu'√† la fin du fichier mod√®le, nous devons lancer un tag-not-closed `Error`.

``` js
engine.registerTag('wrap', {
  parse(tagToken, remainTokens) {
    this.tpls = []
    let closed = false
    while(remainTokens.length) {
      let token = remainTokens.shift()
      // we got the end tag! stop taking tokens
      if (token.name === 'endwrap') {
        closed = true
        break
      }
      // parse token into template
      // parseToken() may consume more than 1 tokens
      // e.g. { % if % }...{ % endif % }
      let tpl = this.liquid.parser.parseToken(token, remainTokens)
      this.tpls.push(tpl)
    }
    if (!closed) throw new Error(`tag ${tagToken.getText()} not closed`)
  },
  * render(context, emitter) {
    emitter.write("<div class='wrapper'>")
    yield this.liquid.renderer.renderTemplates(this.tpls, context, emitter)
    emitter.write("</div>")
  }
})
```

`.renderTemplates()` peut √™tre asynchrone, nous devons `yield` attendre qu'il soit termin√©. Pour plus de d√©tails sur `async` dans LiquidJS, veuillez vous r√©f√©rer √† [Sync et Async](https://liquidjs.com/tutorials/sync-and-async.html){:target="_blank"}. Les autres parties de `render()` la m√©thode est assez simples. Voici une version JSFiddle : https://jsfiddle.net/por0zcn1/3/

### Using ParseStream

En ce qui concerne les balises complexes comme [for](https://liquidjs.com/tags/for.html){:target="_blank"} et [if](https://liquidjs.com/tags/if.html){:target="_blank"}, cela `parse()` peut √™tre tr√®s compliqu√©. Il existe un utilitaire [ParseStream](https://liquidjs.com/api/classes/ParseStream.html){:target="_blank"} pour organiser les balises `parse()` dans un style bas√© sur les √©v√©nements. Voici une version r√©√©crite `parse()` en utilisant `ParseStream` et qui fait exactement la m√™me chose que l'exemple ci-dessus.

``` js
parse(tagToken, remainTokens) {
  this.tpls = []
  this.liquid.parser.parseStream(remainTokens)
    .on('template', tpl => this.tpls.push(tpl))
    // note that we cannot use arrow function because we need `this`
    .on('tag:endwrap', function () { this.stop() })
    .on('end', () => { throw new Error(`tag ${tagToken.getText()} not closed`) })
    .start()
}
```

Voici une version JSFiddle : <https://jsfiddle.net/por0zcn1/4/>{:target="_blank"}. Pour plus de simplicit√©, les exemples suivants sont impl√©ment√©s √† l'aide de `ParseStream`.

### Manipulate the Context

La balise `wrap` ci-dessus ne semble pas tr√®s utile, sans utiliser cette balise, nous pouvons de toute fa√ßon restituer le contenu. Nous allons maintenant impl√©menter une balise `repeat` pour restituer le contenu 2 fois (nous pouvons √©galement ajouter un param√®tre pour restituer des fois arbitraires).

``` js
{ % repeat % }
  {{ repeat.i }}. {{ "hello world!" | capitalize }}
{ % endrepeat % }`
```

R√©sultats attendus :

``` js
1. Hello world!
2. Hello world!
```

Comme vous l'avez remarqu√©, il existe un √©l√©ment suppl√©mentaire `repeat.i` dans le contexte de `repeat`. Cela est impl√©ment√© en manipulant le *Context*.

> **Contexte** : Le contexte d√©finit la valeur de chaque variable dans le mod√®le Liquid. Dans LiquidJS, un `Context` est constitu√© d'une pile de `Scopes`. Une port√©e est un objet simple comme celui sp√©cifi√© dans `engine.render(tpl, scope)`.

Chaque fois que nous entrons dans un nouveau *Context*, nous devons pousser un nouveau *Scope*. Et lorsque nous terminons le rendu et sortons du Context , nous extrayons le *Scope* du *Context*. Comme vous pouvez le voir dans l'impl√©mentation suivante :

``` js
engine.registerTag('repeat', {
  parse(tagToken, remainTokens) {
    this.tpls = []
    this.liquid.parser.parseStream(remainTokens)
      .on('template', tpl => this.tpls.push(tpl))
      .on('tag:endrepeat', function () { this.stop() })
      .on('end', () => { throw new Error(`tag ${tagToken.getText()} not closed`) })
      .start()
  },
  * render(context, emitter) {
    const repeat = { i: 1 }
    context.push({ repeat })
    yield this.liquid.renderer.renderTemplates(this.tpls, context, emitter)
    repeat.i++
    yield this.liquid.renderer.renderTemplates(this.tpls, context, emitter)
    context.pop()
  }
})
```

C'est `parse()` exactement la m√™me chose que `wrap` tag, on r√©p√®te le contenu simplement en appelant .`renderTemplates(this.tpls)` deux fois pendant `render()`. Voici le JSFiddle : <https://jsfiddle.net/por0zcn1/2/>{:target="_blank"}

> **Utilisez Push & Pop par paires** : `context.push()` et `context.pop()` doivent √™tre utilis√©s par paires. L'√©chec de `pop()` la port√©e que vous avez pouss√©e entra√Ænera une fuite de la port√©e vers les mod√®les ult√©rieurs et peut corrompre la pile de contexte.

## Liquid Drops

LiquidJS fournit √©galement un m√©canisme similaire √† [Shopify Drops](https://github.com/Shopify/liquid/wiki/Introduction-to-Drops){:target="_blank"}, permettant aux auteurs de mod√®les d'int√©grer des fonctionnalit√©s personnalis√©es dans la r√©solution des valeurs de variables.

> **Drop pour JavaScript** : L'interface Drop est impl√©ment√©e diff√©remment dans LiquidJS par rapport aux filtres int√©gr√©s et aux autres fonctionnalit√©s de mod√®le. √âtant donn√© que LiquidJS s'ex√©cute en JavaScript, les Drops personnalis√©s doivent de toute fa√ßon √™tre r√©impl√©ment√©s en JavaScript. Il n'y a aucune compatibilit√© entre les classes JavaScript et les classes Ruby.

### Utilisation de base

``` js
import { Liquid, Drop } from 'liquidjs'

class SettingsDrop extends Drop {
  constructor() {
    super()
    this.foo = 'FOO'
  }
  bar() {
    return 'BAR'
  }
}

const engine = new Liquid()
const template = `foo: {{settings.foo}}, bar: {{settings.bar}}`
const context = { settings: new SettingsDrop() }
// Outputs: "foo: FOO, bar: BAR"
engine.parseAndRender(template, context).then(html => console.log(html))
```

[Lien vers Runkit](https://runkit.com/embed/2is7di4mc7kk){:target="_blank"}

Comme indiqu√© ci-dessus, en plus de lire les propri√©t√©s √† partir des port√©es de contexte, vous pouvez √©galement appeler des m√©thodes. Il vous suffit de cr√©er une classe personnalis√©e h√©rit√©e de `Drop`.

> **M√©thodes asynchrones** : LiquidJS est enti√®rement compatible avec l'asynchronisme. Vous pouvez renvoyer en toute s√©curit√© une promesse dans vos m√©thodes `Drop` ou d√©finir vos m√©thodes dans `Drop` comme `async`.

### liquidMethodMissing

Dans les cas o√π il n'existe pas d'ensemble fixe de propri√©t√©s, vous pouvez utiliser cette fonction `liquidMethodMissing` pour r√©soudre dynamiquement la valeur d'un nom de variable.

``` js
import { Liquid, Drop } from 'liquidjs'

class SettingsDrop extends Drop {
  liquidMethodMissing(key) {
    return key.toUpperCase()
  }
}

const engine = new Liquid()
// Outputs: "COO"
engine.parseAndRender("{{settings.coo}}", { settings: new SettingsDrop() })
  .then(html => console.log(html))
```

`liquidMethodMissing` prend en charge Promise, ce qui signifie que vous pouvez effectuer des appels asynchrones √† l'int√©rieur. Un cas plus utile peut √™tre la r√©cup√©ration dynamique de la valeur √† partir de la base de donn√©es. En utilisant Drops, vous pouvez √©viter de coder en dur chaque propri√©t√© dans le contexte. Par exemple :

``` js
import { Liquid, Drop } from 'liquidjs'

class DBDrop extends Drop {
  async liquidMethodMissing(key) {
    const record = await db.getRecordByKey(key)
    return record.value
  }
}

const engine = new Liquid()
const context = { db: new DBDrop() }
engine.parseAndRender("{{db.coo}}", context).then(html => console.log(html))
```

Les gouttes peuvent impl√©menter une `valueOf()` m√©thode dont la valeur de retour peut √™tre utilis√©e pour se remplacer elle-m√™me dans la sortie. Par exemple :

``` js
import { Liquid, Drop } from 'liquidjs'

class ColorDrop extends Drop {
  valueOf() {
    return 'red'
  }
}

const engine = new Liquid()
const context = { color: new ColorDrop() }
// Outputs: "red"
engine.parseAndRender("{{color}}", context).then(html => console.log(html))
```

### toLiquid

`toLiquid()` n'est pas une m√©thode de `Drop`, mais elle peut √™tre utilis√©e pour renvoyer un Drop. Dans les cas o√π vous avez une structure fixe dans laquelle `context` vous ne pouvez pas modifier ses valeurs, vous pouvez impl√©menter `toLiquid()` pour permettre √† LiquidJS d'utiliser la valeur renvoy√©e au lieu de lui-m√™me pour restituer les mod√®les.

``` js
import { Liquid, Drop } from 'liquidjs'

const context = {
  person: {
    firstName: "Jun",
    lastName: "Yang",
    name: "Jun Yang",
    toLiquid: () => ({
      firstName: this.firstName,
      lastName: this.lastName,
      // use a different `name`
      name: "Yang, Jun"
    })
  }
}

const engine = new Liquid()
// Outputs: "Yang, Jun"
engine.parseAndRender("{{person.name}}", context).then(html => console.log(html))
```

Bien s√ªr, vous pouvez √©galement renvoyer une `PersonDrop` instance dans la `toLiquid()` m√©thode et impl√©menter cette fonctionnalit√© dans `PersonDrop` :

``` js
import { Liquid, Drop } from 'liquidjs'

class PersonDrop extends Drop {
  constructor(person) {
    super()
    this.person = person
  }
  name() {
    return this.person.lastName + ", " + this.person.firstName
  }
}

const context = {
  person: {
    firstName: "Jun",
    lastName: "Yang",
    name: "Jun Yang",
    toLiquid: function () { return new PersonDrop(this) }
  }
}

const engine = new Liquid()
// Outputs: "Yang, Jun"
engine.parseAndRender("{{person.name}}", context).then(html => console.log(html))
```

> `toLiquid()` vs. `valueOf()` Diff√©rence
> - `valueOf()` est g√©n√©ralement utilis√© pour d√©finir comment la variable actuelle doit √™tre rendue, tandis qu'il `toLiquid()` est souvent utilis√© pour convertir un objet en Drop ou une autre port√©e fournie au mod√®le.
> - `valueOf()` est une m√©thode exclusive √† Drops ; alors qu'elle `toLiquid()` peut √™tre utilis√©e sur n'importe quel objet de port√©e.
> - `valueOf()` est appel√© lorsque la variable elle-m√™me est sur le point d'√™tre rendue, se rempla√ßant elle-m√™me ; alors qu'il `toLiquid()` est appel√© lorsque ses propri√©t√©s sont sur le point d'√™tre lues.

### Special Drops

LiquidJS lui-m√™me impl√©mente plusieurs gouttes int√©gr√©es pour faciliter l'√©criture de mod√®les. Cette partie est compatible avec Shopify Liquid, car nous avons besoin que les mod√®les soient portables.

#### blank

Utile pour v√©rifier si une variable de cha√Æne est `false`, `null`, `undefined`, une cha√Æne vide ou une cha√Æne contenant uniquement des caract√®res vides.

``` js
{ % unless author == blank % }
    {{author}}
{ % endif % }
```

#### empty

Utile pour v√©rifier si un tableau, une cha√Æne ou un objet est vide.

``` js
{ % if authors == empty % }
    Author list is empty
{ % endif % }
```

> `empty` mise en ≈ìuvre : Pour les tableaux et les cha√Ænes, LiquidJS v√©rifie leurs `.length` propri√©t√©s. Pour les objets, LiquidJS effectue des appels `Object.keys()` pour v√©rifier s'ils ont des cl√©s.

#### nil

`nil` Drop est utilis√© pour v√©rifier si une variable n'est pas d√©finie ou d√©finie comme `null` ou `undefined`, essentiellement √©quivalent √† `== null` la v√©rification JavaScript.

``` js
{ % if nonexistent == nil % }
    null variable
{ % endif % }
```

### Other Drops

Il existe encore plusieurs Drops pour des balises sp√©cifiques, comme `forloop`, `tablerowloop`, `block`, qui sont couverts par les documents de balises respectifs.

## Sync and Async

LiquidJS prend en charge les √©valuations synchrones et asynchrones et peut √™tre utilis√© avec les promesses. Pour r√©utiliser le m√™me ensemble d'impl√©mentations de balises/filtres √† la fois en synchronisation et en asynchrone, les balises LiquidJS sont impl√©ment√©es en tant que g√©n√©rateurs.

### Sync and Async API

Toutes les principales m√©thodes de [Liquid](https://liquidjs.com/api/classes/Liquid.html){:target="_blank"} prennent en charge √† la fois la synchronisation et l'asynchronisation. Ces m√©thodes renvoient des promesses :

- `render()`
- `renderFile()`
- `parseFile()`
- `parseAndRender()`
- `evalValue()`

La version synchrone des m√©thodes contient un `Sync` suffixe :

- `renderSync()`
- `renderFileSync()`
- `parseFileSync()`
- `parseAndRenderSync()`
- `evalValueSync()`

### Implement Sync-Compatible Tags

LiquidJS utilise une impl√©mentation asynchrone bas√©e sur un g√©n√©rateur pour prendre en charge √† la fois l'asynchrone et la synchronisation dans une seule impl√©mentation de balise. Par exemple, ci-dessous `UpperTag` peut √™tre utilis√© √† la fois dans `engine.renderSync()` et `engine.render()`.

``` js
import { TagToken, Context, Emitter, TopLevelToken, Value, Tag, Liquid } from 'liquidjs'

// Usage: { % upper "alice" % }
// Output: ALICE
engine.registerTag('upper', class UpperTag extends Tag {
  private value: Value
  constructor (token: TagToken, remainTokens: TopLevelToken[], liquid: Liquid) {
    super(token, remainTokens, liquid)
    this.value = new Value(token.args, liquid)
  }
  * render (ctx: Context, emitter: Emitter) {
    const title = yield this.value.value(ctx)
    emitter.write(title.toUpperCase())
  }
})
```

Toutes les balises int√©gr√©es sont impl√©ment√©es de cette mani√®re et peuvent √™tre utilis√©es en toute s√©curit√© √† la fois en synchronisation et en asynchrone (je l'appellerai *sync-compatible*). Pour rendre votre balise personnalis√©e *sync-compatible*, vous devrez :

- d√©clarer la fonction de rendu comme `* render()`, dans laquelle
- ne pas directement `return <Promise>`, et
- n'appelez aucune API qui renvoie une promesse.

### Call APIs that return a Promise

Mais LiquidJS est compatible avec Promise, n'est-ce pas ? Vous pouvez toujours appeler des fonctions bas√©es sur Promise et attendre cette promesse dans les impl√©mentations de balises. Remplacez simplement `await` par `yield`. par exemple, nous appelons `fs.readFile()` qui renvoie un `Promise`:

``` js
* render (ctx: Context, emitter: Emitter) {
  const file = yield this.value.value(ctx)
  const title = yield fs.readFile(file, 'utf8')
  emitter.write(title.toUpperCase())
}
```

Maintenant que cela `* render()` appelle une API qui renvoie une promesse, elle n'est plus compatible avec la synchronisation .

> **Balises non compatibles avec la synchronisation** : Les balises non compatibles avec la synchronisation sont √©galement des balises valides et fonctionneront parfaitement pour les appels d'API asynchrones. Lorsqu'elles sont appel√©es de mani√®re synchrone, les balises qui renvoient un `Promise` seront rendues sous la forme `[object Promise]`.

### Convert LiquidJS async Generator to Promise

Vous pouvez convertir un g√©n√©rateur en promesse en utilisant [toPromise](https://liquidjs.com/api/functions/toPromise.html){:target="_blank"}, par exemple :

``` js
import { TagToken, Context, Emitter, TopLevelToken, Value, Tag, Liquid, toPromise } from 'liquidjs'

// Usage: { % upper "alice" % }
// Output: ALICE
engine.registerTag('upper', class UpperTag extends Tag {
  private value: Value
  constructor (token: TagToken, remainTokens: TopLevelToken[], liquid: Liquid) {
    super(token, remainTokens, liquid)
    this.value = new Value(token.args, liquid)
  }
  async render (ctx: Context, emitter: Emitter) {
    const title = await toPromise(this.value.value(ctx))
    emitter.write(title.toUpperCase())
  }
})
```

### Async only Tags

Si votre balise est destin√©e √† √™tre utilis√©e uniquement de mani√®re asynchrone, elle peut √™tre d√©clar√©e ainsi `async render()` afin que vous puissiez l'utiliser `await` directement dans son impl√©mentation :

``` js
import { toPromise, TagToken, Context, Emitter, TopLevelToken, Value, Tag, Liquid } from 'liquidjs'

// Usage: { % upper "alice" % }
// Output: ALICE
engine.registerTag('upper', class UpperTag extends Tag {
  private value: Value
  constructor (token: TagToken, remainTokens: TopLevelToken[], liquid: Liquid) {
    super(token, remainTokens, liquid)
    this.value = new Value(token.args, liquid)
  }
  async render (ctx: Context, emitter: Emitter) {
    const title = await toPromise(this.value.value(ctx))
    emitter.write(`<h1>${title}</h1>`)
  }
})
```

## Whitespace Control

Pour garder le code source propre et indent√©, nous ajoutons des espaces √† nos mod√®les. LiquidJS offre des fonctionnalit√©s de contr√¥le des espaces pour √©liminer ces espaces ind√©sirables dans le code HTML de sortie.

### via Markups

Par d√©faut, toutes les balises et lignes de balisage de sortie g√©n√®rent un NL (`\n`) et des espaces s'il y a une indentation. Par exemple :

``` js
{ %  author = "harttle" % }
{{ author }}
```

Sorties (notez le lien vide) :

``` js
harttle
```

Nous pouvons inclure des tirets dans la syntaxe de votre balise (`{{-`, `-}}`, `{ %-`, `-% }`) pour supprimer les espaces √† gauche ou √† droite. Par exemple :

``` js
{ % assign author = "harttle" -% }
{{ author }}
```

R√©sultats :

``` js
harttle
```

Dans ce cas, il `-% }` supprime l'espace blanc du c√¥t√© droit de la `assign` balise.

### via Options

Alternativement, LiquidJS fournit ces options par moteur pour permettre le contr√¥le des espaces blancs sans modifier radicalement vos mod√®les :

- `trimTagLeft`
- `trimTagRight`
- `trimOutputLeft`
- `trimOutputRight`

[LiquidJS](https://github.com/harttle/liquidjs){:target="_blank"} ne supprimera aucun espace par d√©faut, c'est-√†-dire que toutes les options ci-dessus sont par d√©faut √† false. Pour plus de d√©tails sur ces options, consultez les [options](https://liquidjs.com/api/interfaces/LiquidOptions.html){:target="_blank"}.

### Greedy Mode

En mode gourmand (activ√© par l'[option gourmande](https://liquidjs.com/api/interfaces/LiquidOptions.html#greedy){:target="_blank"}), tous les caract√®res d'espacement cons√©cutifs (y compris `\n`) seront supprim√©s. Le mode gourmand est activ√© par d√©faut pour √™tre conforme √† [Shopify/Liquid](https://github.com/Shopify/liquid){:target="_blank"}.

## Plugins

Un certain nombre de balises et de filtres peuvent √™tre encapsul√©s dans un **plugin**, qui sera g√©n√©ralement install√© via npm. Cet article fournit des informations sur la cr√©ation et l'utilisation d'un plugin.

### √âcrire un plugin

Un plugin liquidjs est une fonction simple qui prend la [classe Liquid](https://liquidjs.com/api/classes/Liquid.html){:target="_blank"} comme premier param√®tre et l'instance Liquid pour `this`. Nous pouvons appeler les API liquidjs `this` pour effectuer certaines modifications, notamment les [register filters and tags](https://liquidjs.com/harttle/liquidjs/wiki/Register-Filters-Tags){:target="_blank"}.

Nous allons maintenant cr√©er un plugin pour mettre en majuscules chaque lettre de l'entr√©e, enregistrez l'extrait suivant dans `upup.js` :

``` js
/**
 * Inside the plugin function, `this` refers to the Liquid instance.
 *
 * @param Liquid: provides facilities to implement tags and filters.
 */
module.exports = function (Liquid) {
    this.registerFilter('upup', x => x.toUpperCase());
}
```

### Utiliser un plugin

Il suffit de transmettre la fonction du plugin dans la `.plugin()` m√©thode :

``` js
const engine = new Liquid()

engine.plugin(require('./upup.js'));
engine
    .parseAndRender('{{ "foo" | upup }}')
    .then(console.log)  // outputs "FOO"
```

### Liste des plugins

√âtant donn√© que cette biblioth√®que exclut certaines fonctionnalit√©s disponibles sur la plateforme Shopify mais pas sur le r√©f√©rentiel [Shopify/liquid](https://github.com/Shopify/liquid/){:target="_blank"}, consultez [Diff√©rences avec Shopify/liquid](https://liquidjs.com/tutorials/differences.html){:target="_blank"}.

Voici une liste de plugins qui compl√®tent ces fonctionnalit√©s. N'h√©sitez pas √† ajouter les v√¥tres, ce fichier est modifiable publiquement.

- Balises des sections (WIP) : <https://github.com/harttle/liquidjs-section-tags>{:target="_blank"}
- Filtres de couleur : <https://github.com/harttle/liquidjs-color-filters>{:target="_blank"}

## Op√©rateurs

Les op√©rateurs LiquidJS sont tr√®s simples et diff√©rents. Il existe 2 types d'op√©rateurs pris en charge :

- Op√©rateurs de comparaison : `==`, `!=`, `>`, `<`, `>=`, `<=`
- Op√©rateurs logiques : `or`, `and`, `contains`

Ainsi, les op√©rateurs num√©riques ne sont pas pris en charge et vous ne pouvez m√™me pas ajouter deux nombres comme cela `{{a + b}}`, √† la place nous avons besoin d'un filtre `{{ a | plus: b}}`. En fait, `+` c'est un nom de variable valide dans LiquidJS.

### Priorit√©

# Op√©rateurs de comparaison. Toutes les op√©rations de comparaison ont la m√™me priorit√© et sont sup√©rieures aux op√©rateurs logiques.
# Op√©rateurs logiques. Tous les op√©rateurs logiques ont la m√™me priorit√©.

### Associativit√©

Les op√©rateurs logiques sont √©valu√©s de droite √† gauche, voir [la documentation Shopify](https://help.shopify.com/en/themes/liquid/basics/operators#order-of-operations){:target="_blank"}.

## Vrai et faux

Bien que Liquid soit ind√©pendant de la plate-forme, il existe [certaines diff√©rences](https://github.com/harttle/liquidjs#differences-and-limitations){:target="_blank"} avec [la version Ruby](https://shopify.github.io/liquid){:target="_blank"}, dont l'une est la `truthy` valeur.

### La table de v√©rit√©

D'apr√®s [le document Shopify](https://shopify.github.io/liquid/basics/truthy-and-falsy/){:target="_blank"}, tout ce qui n'est pas `false` et `nil` est vrai. Mais en JavaScript, nous avons un syst√®me de types totalement diff√©rent, nous avons des types comme `undefined` et nous ne faisons pas de distinction entre `integer` et `float`, donc les choses sont l√©g√®rement diff√©rentes :

| valeur       | v√©ridique | fausset√© |
| :----------- | --------: | -------: |
| true         |     ‚úîÔ∏è    |          |
| false	       |           |    ‚úîÔ∏è    |
| null	       |           |    ‚úîÔ∏è    |
| undefined    |           |    ‚úîÔ∏è    |
| string       |     ‚úîÔ∏è    |          |	
| empty string |     ‚úîÔ∏è    |          |
| 0	           |     ‚úîÔ∏è    |          |
| integer      |     ‚úîÔ∏è    |          |
| float        |     ‚úîÔ∏è    |          |
| array        |     ‚úîÔ∏è    |          |
| empty array  |     ‚úîÔ∏è    |          |

### Utilisez JavaScript Truthy

Notez que LiquidJS utilise la v√©rit√© de Shopify par d√©faut. Mais il peut √™tre bascul√© pour utiliser la v√©rit√© JavaScript standard en d√©finissant l' option `jsTruthy` sur `true`.

| valeur       | v√©ridique | fausset√© |
| :----------- | --------: | -------: |
| true         |     ‚úîÔ∏è    |          |
| false	       |           |    ‚úîÔ∏è    |
| null	       |           |    ‚úîÔ∏è    |
| undefined    |           |    ‚úîÔ∏è    |
| string       |     ‚úîÔ∏è    |          |	
| empty string |           |    ‚úîÔ∏è    |
| 0	           |           |    ‚úîÔ∏è    |
| integer      |     ‚úîÔ∏è    |          |
| float        |     ‚úîÔ∏è    |          |
| array        |     ‚úîÔ∏è    |          |
| empty array  |     ‚úîÔ∏è    |          |

## Pr√©vention des attaques DoS

Lorsque le mod√®le ou le contexte de donn√©es ne sont pas fiables, il est essentiel d'activer les options de pr√©vention DoS. LiquidJS propose 3 options √† cet effet : `parseLimit`, `renderLimit`, et `memoryLimit`.

### TL;DR

La d√©finition de ces options peut en grande partie garantir que votre instance LiquidJS ne se bloquera pas pendant des p√©riodes prolong√©es ou ne consommera pas de m√©moire excessive. Ces limites sont bas√©es sur les API JavaScript disponibles, il ne s'agit donc pas de limites strictes pr√©cises, mais de seuils permettant d'√©viter que votre processus ne tombe en panne ou ne se bloque.

``` js
const liquid = new Liquid({
    parseLimit: 1e8, // typical size of your templates in each render
    renderLimit: 1000, // limit each render to be completed in 1s
    memoryLimit: 1e9, // memory available for LiquidJS (1e9 for 1GB)
})
```

Lorsqu'un `parse()` ou `render()` ne peut pas √™tre compl√©t√© dans le cadre d'une ressource donn√©e, il est rejet√©.

### parseLimit

[parseLimit](https://liquidjs.com/api/interfaces/LiquidOptions.html#parseLimit){:target="_blank"} limite la taille (longueur des caract√®res) des mod√®les analys√©s √† chaque `.parse()` appel, y compris les partiels et les mises en page r√©f√©renc√©s. √âtant donn√© que LiquidJS analyse les cha√Ænes de mod√®les en un temps proche de O(n), la limitation de la longueur totale du mod√®le est g√©n√©ralement suffisante.

Un PC typique g√®re `1e8` (100 M) de caract√®res sans probl√®me.

### renderLimit

Restreindre la taille du mod√®le seul n'est pas suffisant car des boucles dynamiques avec un grand nombre peuvent se produire au moment du rendu. [renderLimit](https://liquidjs.com/api/interfaces/LiquidOptions.html#renderLimit){:target="_blank"} att√©nue ce probl√®me en limitant le temps consomm√© par chaque `render()` appel.

``` js
{ %- for i in (1..10000000) -% }
    order: {{i}}
{ %- endfor -% }
```

Le temps de rendu est v√©rifi√© pour chaque mod√®le (avant le rendu de chaque mod√®le). Dans l'exemple ci-dessus, il y a 2 mod√®les dans la boucle : `order:` et `{{i}}`, le temps de rendu sera v√©rifi√© 10000000x2 fois.

Pour les balises et les filtres chronophages au sein d'un seul mod√®le, le processus peut toujours se bloquer. Pour un rendu enti√®rement contr√¥l√©, pensez √† utiliser un gestionnaire de processus comme [paralleljs](https://www.npmjs.com/package/paralleljs){:target="_blank"}.

### memoryLimit

M√™me avec un nombre r√©duit de mod√®les et d'it√©rations, l'utilisation de la m√©moire peut augmenter de mani√®re exponentielle. Dans l'exemple suivant, la m√©moire double √† chaque it√©ration :

``` js
{ % assign array = "1,2,3" | split: "," % }
{ % for i in (1..32) % }
    { % assign array = array | concat: array % }
{ % endfor % }
```

[memoryLimit](https://liquidjs.com/api/interfaces/LiquidOptions.html#memoryLimit){:target="_blank"} limite les filtres sensibles √† la m√©moire pour √©viter une allocation de m√©moire excessive. Comme [JavaScript utilise GC pour g√©rer la m√©moire](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Memory_management){:target="_blank"}, `memoryLimit` limite uniquement le nombre total d'objets allou√©s par les filtres sensibles √† la m√©moire dans LiquidJS et peut donc ne pas refl√©ter l'empreinte m√©moire r√©elle.

